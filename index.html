
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>콘킾 - ConKeep | 스마트 기프티콘 관리</title>
    <meta name="description" content="AI 기반 기프티콘 자동 인식 및 관리 서비스">
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#6366f1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="콘킾">
    
    <!-- External Libraries -->
    <script src="https://unpkg.com/@zxing/library@latest/umd/index.min.js"></script>
    <script src="https://unpkg.com/qrcode@1.5.3/build/qrcode.min.js"></script>
    
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-spinner"></div>
        <p>콘킾 로딩중...</p>
    </div>

    <!-- Main App Container -->
    <div id="app" class="app-container" style="display: none;">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <h1 class="app-title">
                    <span class="logo">🎁</span>
                    콘킾
                </h1>
                <div class="header-actions">
                    <button id="theme-toggle" class="icon-btn" aria-label="테마 변경">
                        <span class="theme-icon">🌙</span>
                    </button>
                    <button id="settings-btn" class="icon-btn" aria-label="설정">
                        <span>⚙️</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="tab-nav">
            <button class="tab-btn active" data-tab="dashboard">
                <span>📊</span>
                <span>대시보드</span>
            </button>
            <button class="tab-btn" data-tab="add">
                <span>➕</span>
                <span>등록</span>
            </button>
            <button class="tab-btn" data-tab="shared">
                <span>🔗</span>
                <span>공유</span>
            </button>
        </nav>

        <!-- Dashboard Tab -->
        <main id="dashboard-tab" class="tab-content active">
            <!-- Search & Filter -->
            <div class="search-section">
                <div class="search-bar">
                    <input type="text" id="search-input" placeholder="브랜드명이나 상품명으로 검색..." />
                    <button id="filter-btn" class="filter-btn">🔽</button>
                </div>
                <div id="filter-panel" class="filter-panel hidden">
                    <div class="filter-group">
                        <label>브랜드</label>
                        <select id="brand-filter">
                            <option value="">전체</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>상태</label>
                        <select id="status-filter">
                            <option value="">전체</option>
                            <option value="unused">미사용</option>
                            <option value="used">사용완료</option>
                            <option value="expired">만료</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Stats -->
            <div class="stats-row">
                <div class="stat-card">
                    <div class="stat-number" id="total-count">0</div>
                    <div class="stat-label">전체</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="unused-count">0</div>
                    <div class="stat-label">미사용</div>
                </div>
                <div class="stat-card urgent">
                    <div class="stat-number" id="expiring-count">0</div>
                    <div class="stat-label">만료임박</div>
                </div>
            </div>

            <!-- Coupons Grid -->
            <div id="coupons-grid" class="coupons-grid">
                <div class="empty-state" id="empty-state">
                    <div class="empty-icon">🎁</div>
                    <h3>등록된 기프티콘이 없습니다</h3>
                    <p>새 기프티콘을 등록해보세요!</p>
                    <button class="primary-btn" onclick="switchTab('add')">등록하기</button>
                </div>
            </div>
        </main>

        <!-- Add Coupon Tab -->
        <main id="add-tab" class="tab-content">
            <div class="add-section">
                <h2>새 기프티콘 등록</h2>
                
                <!-- Upload Area -->
                <div class="upload-area" id="upload-area">
                    <div class="upload-content">
                        <div class="upload-icon">📸</div>
                        <h3>이미지를 업로드하세요</h3>
                        <p>바코드/QR코드가 포함된 기프티콘 이미지</p>
                        <button class="upload-btn">파일 선택</button>
                    </div>
                    <input type="file" id="file-input" accept="image/*" capture="environment" style="display: none;">
                </div>

                <!-- Preview & Edit -->
                <div id="preview-section" class="preview-section hidden">
                    <div class="image-preview">
                        <img id="preview-image" alt="업로드된 이미지">
                        <div class="scan-overlay" id="scan-overlay">
                            <div class="scan-line"></div>
                            <p>바코드 스캔중...</p>
                        </div>
                    </div>
                    
                    <div class="coupon-form">
                        <div class="form-group">
                            <label for="coupon-code">바코드/QR 코드</label>
                            <input type="text" id="coupon-code" readonly>
                            <button id="rescan-btn" class="secondary-btn">재스캔</button>
                        </div>
                        
                        <div class="form-group">
                            <label for="coupon-brand">브랜드</label>
                            <input type="text" id="coupon-brand" placeholder="예: 스타벅스">
                        </div>
                        
                        <div class="form-group">
                            <label for="coupon-name">상품명</label>
                            <input type="text" id="coupon-name" placeholder="예: 아메리카노 Tall">
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="coupon-amount">금액</label>
                                <input type="number" id="coupon-amount" placeholder="원">
                            </div>
                            <div class="form-group">
                                <label for="coupon-expiry">유효기간</label>
                                <input type="date" id="coupon-expiry">
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button id="save-coupon" class="primary-btn">저장하기</button>
                            <button id="cancel-add" class="secondary-btn">취소</button>
                        </div>
                    </div>
                </div>

                <!-- AI Analysis Status -->
                <div id="ai-analysis" class="ai-analysis hidden">
                    <div class="ai-spinner"></div>
                    <p>AI가 쿠폰 정보를 분석중입니다...</p>
                </div>
            </div>
        </main>

        <!-- Shared Tab -->
        <main id="shared-tab" class="tab-content">
            <div class="shared-section">
                <h2>공유된 기프티콘</h2>
                <div id="shared-coupons" class="coupons-grid">
                    <div class="empty-state">
                        <div class="empty-icon">🔗</div>
                        <h3>공유된 기프티콘이 없습니다</h3>
                        <p>기프티콘을 공유하여 가족과 함께 사용하세요!</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>설정</h2>
                <button class="close-btn" data-modal="settings">&times;</button>
            </div>
            <div class="modal-body">
                <div class="setting-group">
                    <h3>Google Gemini API 키</h3>
                    <div class="api-key-section">
                        <input type="password" id="api-key-input" placeholder="API 키를 입력하세요">
                        <button id="save-api-key" class="primary-btn">저장</button>
                    </div>
                    <p class="help-text">
                        AI 기능을 사용하려면 Google Gemini API 키가 필요합니다.
                        <a href="https://makersuite.google.com/app/apikey" target="_blank">여기서 발급받으세요</a>
                    </p>
                </div>
                
                <div class="setting-group">
                    <h3>알림 설정</h3>
                    <div class="notification-settings">
                        <label class="switch">
                            <input type="checkbox" id="notifications-enabled">
                            <span class="slider"></span>
                            만료 알림 받기
                        </label>
                        <div class="notification-timing">
                            <label>
                                <input type="checkbox" id="notify-7days" checked>
                                7일 전 알림
                            </label>
                            <label>
                                <input type="checkbox" id="notify-1day" checked>
                                1일 전 알림
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="setting-group">
                    <h3>데이터 관리</h3>
                    <button id="export-data" class="secondary-btn">데이터 내보내기</button>
                    <button id="clear-data" class="danger-btn">모든 데이터 삭제</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Coupon Detail Modal -->
    <div id="coupon-modal" class="modal hidden">
        <div class="modal-content coupon-detail">
            <div class="modal-header">
                <h2 id="modal-coupon-title">기프티콘 상세</h2>
                <button class="close-btn" data-modal="coupon">&times;</button>
            </div>
            <div class="modal-body">
                <div class="coupon-image-container">
                    <img id="modal-coupon-image" alt="쿠폰 이미지">
                </div>
                <div class="coupon-details">
                    <div class="detail-row">
                        <span class="label">브랜드:</span>
                        <span id="modal-coupon-brand"></span>
                    </div>
                    <div class="detail-row">
                        <span class="label">상품명:</span>
                        <span id="modal-coupon-name"></span>
                    </div>
                    <div class="detail-row">
                        <span class="label">금액:</span>
                        <span id="modal-coupon-amount"></span>
                    </div>
                    <div class="detail-row">
                        <span class="label">유효기간:</span>
                        <span id="modal-coupon-expiry"></span>
                    </div>
                    <div class="detail-row">
                        <span class="label">바코드:</span>
                        <span id="modal-coupon-code" class="code"></span>
                    </div>
                </div>
                <div class="coupon-actions">
                    <button id="toggle-used" class="primary-btn">사용 완료</button>
                    <button id="share-coupon" class="secondary-btn">공유하기</button>
                    <button id="delete-coupon" class="danger-btn">삭제</button>
                </div>
                <div id="share-section" class="share-section hidden">
                    <div class="qr-container">
                        <canvas id="qr-canvas"></canvas>
                    </div>
                    <div class="share-link">
                        <input type="text" id="share-url" readonly>
                        <button id="copy-link" class="secondary-btn">복사</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Share Page (Hidden by default) -->
    <div id="share-page" class="share-page hidden">
        <div class="share-container">
            <div class="share-header">
                <h1>공유된 기프티콘</h1>
                <p>콘킾에서 공유됨</p>
            </div>
            <div class="shared-coupon-card">
                <img id="share-coupon-image" alt="쿠폰 이미지">
                <div class="share-coupon-info">
                    <h2 id="share-coupon-title"></h2>
                    <div class="share-details">
                        <p><strong>브랜드:</strong> <span id="share-coupon-brand"></span></p>
                        <p><strong>유효기간:</strong> <span id="share-coupon-expiry"></span></p>
                        <p><strong>금액:</strong> <span id="share-coupon-amount"></span></p>
                    </div>
                    <div class="usage-toggle">
                        <label class="switch">
                            <input type="checkbox" id="share-usage-toggle">
                            <span class="slider"></span>
                            사용 완료
                        </label>
                    </div>
                </div>
            </div>
            <div class="share-actions">
                <button id="back-to-app" class="primary-btn">앱으로 돌아가기</button>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toast-container" class="toast-container"></div>

    <script type="module" src="app.js"></script>
</body>
</html>
